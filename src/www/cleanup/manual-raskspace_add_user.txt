##CREATE NEW USER FOR DEPLOYMENT ON RACKSPACE SETUP


### ON LOCAL MACHINE

##GENERATE SSH KEY IF USER DOES NOT HAVE ONE ALREADY
# default location (~/.ssh/id_rsa.pub)

ssh-keygen -t rsa -C "your_email@example.com"


## UPLOAD SSH KEY TO EXISTING USER ON SERVER
# must be done from authorized computer

scp -P __PORT__ id_rsa.pub __USERNAME__@__IP__:/home/__USERNAME__/new_key
scp -P __PORT__ id_rsa.pub __USERNAME__@__IP__:/home/__USERNAME__/new_key



### ON SERVER

## CREATE NEW USER ON SERVER

sudo adduser __USERNAME__

# ADD USER TO DEPLOY GROUP
sudo usermod -a -G deploy __USERNAME__


# MAKE .ssh FOLDER FOR NEW USER AND COPY UPLOADED KEY
sudo mkdir -p /home/__USERNAME__/.ssh
sudo mv /home/__USERNAME__/new_key /home/__USERNAME__/.ssh/authorized_keys


# SET PERMISSIONS
sudo chown -R __USERNAME__:__USERNAME__ /home/__USERNAME__/.ssh
sudo chmod 700 /home/__USERNAME__/.ssh
sudo chmod 600 /home/__USERNAME__/.ssh/authorized_keys


# ADD USER TO SSHD CONFIG
sudo vi /etc/ssh/sshd_config

AllowUsers _existingusers_ __USERNAME__

# RESTART SSH
sudo service ssh restart


# USER CAN NOT LOGIN AND UPDATE SETTINGS

# ADD GITHUB SETTINGS FOR USER
sudo -u __USERNAME__ git config --global user.name "__USERNAME__"
sudo -u git config --global user.email "__EMAIL__"
sudo -u git config --global credential.helper cache


